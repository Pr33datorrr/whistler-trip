<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sea-to-Sky: Views, Vibes & Veggie Feasts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mountain-dark': '#1e293b',
                        'forest-green': '#166534',
                        'sky-blue': '#0ea5e9',
                        'alert-red': '#ef4444',
                        'safe-green': '#dcfce7',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar hide for clean UI */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 pb-20">

    <header class="sticky top-0 z-50 bg-mountain-dark text-white shadow-lg">
        <div class="px-4 py-3 flex justify-between items-center max-w-2xl mx-auto">
            <div>
                <h1 class="font-bold text-lg">Sea-to-Sky Trip</h1>
                <p class="text-xs text-gray-300">Surrey ‚áÑ Whistler</p>
            </div>
            <button onclick="findNearestStop()" class="bg-sky-blue hover:bg-sky-600 text-white text-xs font-bold py-2 px-3 rounded-full flex items-center transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Locate Me
            </button>
        </div>
        
        <div class="flex text-sm font-medium border-t border-slate-700">
            <button onclick="switchDay(0)" id="btn-day1" class="flex-1 py-3 text-center bg-slate-700 text-white border-b-4 border-sky-blue transition">Day 1: Tue</button>
            <button onclick="switchDay(1)" id="btn-day2" class="flex-1 py-3 text-center bg-mountain-dark text-gray-400 border-b-4 border-transparent transition">Day 2: Wed</button>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-4 mt-4">

        <div class="bg-red-50 border-l-4 border-alert-red p-4 mb-6 rounded shadow-sm">
            <h3 class="font-bold text-red-800 text-sm flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                Non-Negotiables
            </h3>
            <ul class="list-disc list-inside text-xs text-red-700 mt-2 space-y-1">
                <li><strong>Tires:</strong> M+S or Mountain Snowflake mandatory.</li>
                <li><strong>Bridge Logic:</strong> Leave 7 AM sharp (Day 1) & 6:30 PM (Day 2).</li>
                <li><strong>Diet:</strong> STRICT VEGETARIAN (No Egg).</li>
            </ul>
        </div>

        <div id="geo-status" class="hidden mb-4 p-3 bg-sky-100 text-sky-800 rounded text-sm text-center font-medium border border-sky-200"></div>

        <div id="timeline-container" class="space-y-6 relative border-l-2 border-gray-200 ml-3 pl-6 pb-4">
            </div>

        <div class="mt-8 bg-white p-6 rounded-lg shadow border border-gray-100">
            <h3 class="font-bold text-gray-800 mb-3">üí∞ Budget Target</h3>
            <div class="flex justify-between items-end border-b pb-2 mb-2">
                <span class="text-sm text-gray-500">Per Person</span>
                <span class="font-bold text-xl text-forest-green">$200 - $250 CAD</span>
            </div>
            <p class="text-xs text-gray-400">Includes Gas, Shared Lodging, Family-Style Food, Parking.</p>
        </div>
    </main>

    <script>
        // ==========================================
        // 1. ITINERARY DATA (JSON CONFIG)
        // Edit this section to update the app.
        // ==========================================
        const itinerary = [
            {
                day: "Day 1: Waterfalls & Curry",
                date: "Tuesday, Feb 17",
                stops: [
                    {
                        time: "07:00 AM",
                        title: "Depart Surrey",
                        location: "Tim Hortons (Surrey)",
                        coords: { lat: 49.1044, lng: -122.8011 }, // Example Surrey coords
                        type: "logistics",
                        notes: "Departure is strict to beat bridge traffic.",
                        dietary: {
                            safe: true,
                            rec: "Bagel w/ Peanut Butter OR Oatmeal.",
                            warn: "No Breakfast Sandwiches (Egg)."
                        },
                        linkQuery: "Tim Hortons Surrey"
                    },
                    {
                        time: "08:15 AM",
                        title: "Porteau Cove",
                        location: "Porteau Cove Provincial Park",
                        coords: { lat: 49.5604, lng: -123.2346 },
                        type: "activity",
                        notes: "30 min stop. Walk the pier, look for seals.",
                        linkQuery: "Porteau Cove Provincial Park"
                    },
                    {
                        time: "09:00 AM",
                        title: "Shannon Falls",
                        location: "Shannon Falls Provincial Park",
                        coords: { lat: 49.6715, lng: -123.1569 },
                        type: "activity",
                        notes: "20 min stop. Low effort, high reward waterfall.",
                        linkQuery: "Shannon Falls Provincial Park"
                    },
                    {
                        time: "10:00 AM",
                        title: "Hike: Murrin Park",
                        location: "Murrin Provincial Park",
                        coords: { lat: 49.6389, lng: -123.2125 },
                        type: "activity",
                        notes: "Hike to Quercus Viewpoint. Wear boots (muddy).",
                        linkQuery: "Murrin Provincial Park"
                    },
                    {
                        time: "12:30 PM",
                        title: "Lunch: Sunny Chibas",
                        location: "Sunny Chibas Fried Chicken Mexican Cantina",
                        coords: { lat: 49.7289, lng: -123.1465 },
                        type: "food",
                        notes: "Legendary Mexican food. Ask to sub cheese for extra guac.",
                        dietary: {
                            safe: true,
                            rec: "Vegan Taco/Burrito (Bean filling, Pico, Guac).",
                            warn: "Avoid standard mayo/slaw if unsure."
                        },
                        linkQuery: "Sunny Chibas Squamish"
                    },
                    {
                        time: "02:00 PM",
                        title: "Afternoon Adventure",
                        location: "Alice Lake OR Tantalus Lookout",
                        coords: { lat: 49.7749, lng: -123.1256 },
                        type: "activity",
                        notes: "Option A: Alice Lake Loop (Forest). Option B: Tantalus (Viewpoint drive).",
                        linkQuery: "Alice Lake Provincial Park"
                    },
                    {
                        time: "06:00 PM",
                        title: "Dinner: Indian Masala",
                        location: "Indian Masala Bar & Grill",
                        coords: { lat: 49.7016, lng: -123.1558 },
                        type: "food",
                        notes: "Order Family Style to save cash. Best value.",
                        dietary: {
                            safe: true,
                            rec: "Chana Masala, Dal Makhani, Aloo Gobi, Tandoori Roti.",
                            warn: "Naan might have egg (ask). Roti is safe."
                        },
                        linkQuery: "Indian Masala Bar & Grill Squamish"
                    },
                    {
                        time: "08:00 PM",
                        title: "Lodging Check-In",
                        location: "Squamish Adventure Inn",
                        coords: { lat: 49.6976, lng: -123.1610 },
                        type: "logistics",
                        notes: "Has a kitchen for late-night chai.",
                        linkQuery: "Squamish Adventure Inn"
                    }
                ]
            },
            {
                day: "Day 2: Whistler & The Exit Strategy",
                date: "Wednesday, Feb 18",
                stops: [
                    {
                        time: "08:30 AM",
                        title: "Drive to Whistler",
                        location: "Whistler Day Lot 4",
                        coords: { lat: 50.1163, lng: -122.9574 },
                        type: "logistics",
                        notes: "Target Lot 4 or 5 ($10/day). Expensive parking closer in.",
                        linkQuery: "Whistler Day Lot 4"
                    },
                    {
                        time: "10:00 AM",
                        title: "Village & Train Wreck",
                        location: "Whistler Train Wreck",
                        coords: { lat: 50.0833, lng: -122.9833 },
                        type: "activity",
                        notes: "Village Stroll first, then Train Wreck suspension bridge hike.",
                        linkQuery: "Whistler Train Wreck trailhead"
                    },
                    {
                        time: "01:00 PM",
                        title: "Lunch: Warehouse",
                        location: "El Furniture Warehouse",
                        coords: { lat: 50.1150, lng: -122.9550 },
                        type: "food",
                        notes: "Everything is cheap (~$10-15).",
                        dietary: {
                            safe: true,
                            rec: "General Tao Bowl (verify breading) OR Veggie Burger.",
                            warn: "Veggie Burger: Lettuce Wrap + NO Mayo (Bun has egg wash)."
                        },
                        linkQuery: "El Furniture Warehouse Whistler"
                    },
                    {
                        time: "03:00 PM",
                        title: "Secret Waterfall",
                        location: "Whistler Bungee Bridge",
                        coords: { lat: 50.0683, lng: -123.0645 },
                        type: "activity",
                        notes: "The Hack: Park at Bungee Bridge, walk across to see Brandywine Falls.",
                        linkQuery: "Whistler Bungee Bridge"
                    },
                    {
                        time: "04:30 PM",
                        title: "Traffic Kill Strategy",
                        location: "Cloudburst Cafe / Squamish Dyke",
                        coords: { lat: 49.7891, lng: -123.1437 },
                        type: "logistics",
                        notes: "DO NOT drive to Surrey yet. Wait until 6:30 PM.",
                        dietary: {
                            safe: true,
                            rec: "Egg-free cookies available.",
                            warn: ""
                        },
                        linkQuery: "Cloudburst Cafe Squamish"
                    },
                    {
                        time: "06:30 PM",
                        title: "Drive Home",
                        location: "Surrey",
                        coords: { lat: 49.1044, lng: -122.8011 },
                        type: "logistics",
                        notes: "Smooth sailing after the rush hour.",
                        linkQuery: "Surrey BC"
                    }
                ]
            }
        ];

        // ==========================================
        // 2. APP LOGIC
        // ==========================================

        // Render the itinerary
        function switchDay(dayIndex) {
            const container = document.getElementById('timeline-container');
            const data = itinerary[dayIndex];
            
            // Toggle Tab Styles
            const btn1 = document.getElementById('btn-day1');
            const btn2 = document.getElementById('btn-day2');
            
            if(dayIndex === 0) {
                btn1.classList.replace('bg-mountain-dark', 'bg-slate-700');
                btn1.classList.replace('border-transparent', 'border-sky-blue');
                btn1.classList.replace('text-gray-400', 'text-white');
                
                btn2.classList.replace('bg-slate-700', 'bg-mountain-dark');
                btn2.classList.replace('border-sky-blue', 'border-transparent');
                btn2.classList.replace('text-white', 'text-gray-400');
            } else {
                btn2.classList.replace('bg-mountain-dark', 'bg-slate-700');
                btn2.classList.replace('border-transparent', 'border-sky-blue');
                btn2.classList.replace('text-gray-400', 'text-white');
                
                btn1.classList.replace('bg-slate-700', 'bg-mountain-dark');
                btn1.classList.replace('border-sky-blue', 'border-transparent');
                btn1.classList.replace('text-white', 'text-gray-400');
            }

            // Build HTML
            let html = '';
            
            data.stops.forEach(stop => {
                const isFood = stop.type === 'food';
                const isAlert = stop.type === 'logistics' && stop.notes.includes('Strict');
                
                let icon = '';
                if(stop.type === 'food') icon = 'üçî';
                else if(stop.type === 'activity') icon = 'üèîÔ∏è';
                else icon = 'üöó';

                // Deep Links
                const navLink = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(stop.linkQuery)}`;
                const reviewLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(stop.linkQuery)}`;

                html += `
                <div class="relative pl-2">
                    <div class="absolute -left-[33px] top-1 h-6 w-6 rounded-full border-4 border-white ${isFood ? 'bg-forest-green' : 'bg-sky-blue'} shadow-sm flex items-center justify-center text-xs">
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-4 mb-4">
                        <div class="flex justify-between items-start mb-1">
                            <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold tracking-wide uppercase ${isFood ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'}">
                                ${stop.time}
                            </span>
                            <span class="text-lg">${icon}</span>
                        </div>
                        
                        <h3 class="font-bold text-gray-800 text-lg leading-tight mb-1">${stop.title}</h3>
                        <p class="text-sm text-gray-500 mb-3">${stop.location}</p>
                        
                        <p class="text-sm text-gray-700 mb-3 italic">"${stop.notes}"</p>

                        ${stop.dietary ? `
                        <div class="bg-safe-green border border-green-200 rounded p-3 mb-3">
                            <div class="flex items-center mb-1">
                                <svg class="w-4 h-4 text-green-700 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                                <span class="text-xs font-bold text-green-800 uppercase">Egg-Free Order</span>
                            </div>
                            <p class="text-sm text-gray-800 font-medium">${stop.dietary.rec}</p>
                            ${stop.dietary.warn ? `<p class="text-xs text-red-600 mt-1">‚ö†Ô∏è ${stop.dietary.warn}</p>` : ''}
                        </div>
                        ` : ''}

                        <div class="flex gap-2 mt-4">
                            <a href="${navLink}" target="_blank" class="flex-1 bg-sky-blue hover:bg-sky-600 text-white text-center py-2 rounded text-sm font-semibold shadow-sm transition">
                                Navigate ‚Üó
                            </a>
                            <a href="${reviewLink}" target="_blank" class="flex-1 bg-white hover:bg-gray-50 text-slate-600 border border-slate-300 text-center py-2 rounded text-sm font-semibold transition">
                                Check Traffic
                            </a>
                        </div>
                    </div>
                </div>
                `;
            });

            container.innerHTML = html;
        }

        // ==========================================
        // 3. GEOLOCATION (HAVERSINE FORMULA)
        // ==========================================
        function findNearestStop() {
            const statusDiv = document.getElementById('geo-status');
            statusDiv.classList.remove('hidden');
            statusDiv.innerHTML = "Locating you...";

            if (!navigator.geolocation) {
                statusDiv.innerHTML = "Geolocation is not supported by your browser.";
                return;
            }

            navigator.geolocation.getCurrentPosition((position) => {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;

                // Flatten all stops into one array for searching
                const allStops = [...itinerary[0].stops, ...itinerary[1].stops];
                
                let nearest = null;
                let minDist = Infinity;

                allStops.forEach(stop => {
                    if (stop.coords) {
                        const dist = getDistanceFromLatLonInKm(userLat, userLng, stop.coords.lat, stop.coords.lng);
                        if (dist < minDist) {
                            minDist = dist;
                            nearest = stop;
                        }
                    }
                });

                if (nearest) {
                    statusDiv.innerHTML = `
                        üìç You are <strong>${minDist.toFixed(1)} km</strong> from 
                        <br><span class="font-bold text-sky-700">${nearest.title}</span>.
                    `;
                }
            }, () => {
                statusDiv.innerHTML = "Unable to retrieve your location. Check permissions.";
            });
        }

        function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the earth in km
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }

        // Initialize App
        window.onload = () => {
            switchDay(0); // Load Day 1 by default
        };
    </script>
</body>
</html>
