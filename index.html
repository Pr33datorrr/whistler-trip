<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Surrey ‚áÑ Whistler Group Trip Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-950 text-slate-100">
    <div class="min-h-screen">
      <header class="sticky top-0 z-10 bg-slate-950/90 backdrop-blur">
        <div class="mx-auto max-w-3xl px-4 py-5">
          <p class="text-xs uppercase tracking-[0.25em] text-slate-400">Group Trip Dashboard</p>
          <h1 class="mt-2 text-2xl font-semibold">üèîÔ∏è Surrey ‚áÑ Whistler: Views, Vibes & Veggie Feasts</h1>
          <p class="mt-2 text-sm text-slate-300">Feb 17‚Äì18 (Tue‚ÄìWed) ‚Ä¢ Group of 4 ‚Ä¢ Strict Vegetarian (No Egg)</p>
        </div>
      </header>

      <main class="mx-auto max-w-3xl px-4 pb-16">
        <section class="mt-6 rounded-3xl border border-slate-800 bg-slate-900/60 p-5">
          <h2 class="text-lg font-semibold">‚ö†Ô∏è Non-Negotiables</h2>
          <ul class="mt-3 space-y-2 text-sm text-slate-200">
            <li class="flex items-start gap-2"><span>‚úÖ</span><span>M+S or Mountain Snowflake tires required. Police checks are common.</span></li>
            <li class="flex items-start gap-2"><span>ü•ó</span><span>Every food stop is vetted for strict vegetarian (No Egg).</span></li>
            <li class="flex items-start gap-2"><span>üåâ</span><span>Bridge Logic: Leave at 7:00 AM; stop in Squamish on return to miss rush hour.</span></li>
          </ul>
        </section>

        <section class="mt-6 rounded-3xl border border-slate-800 bg-slate-900/60 p-5">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h2 class="text-lg font-semibold">üìç Where are we?</h2>
              <p class="text-sm text-slate-300">Tap to get your coordinates and distance to the next scheduled stop.</p>
            </div>
            <button id="findUsBtn" class="rounded-full bg-emerald-400 px-5 py-3 text-sm font-semibold text-emerald-950 shadow-lg shadow-emerald-500/30">Find Us</button>
          </div>
          <div id="locationOutput" class="mt-4 rounded-2xl border border-slate-800 bg-slate-950/60 p-4 text-sm text-slate-200">
            <p>Waiting for location‚Ä¶</p>
          </div>
        </section>

        <section class="mt-8">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-semibold">üìÖ Timeline</h2>
            <button id="resetProgress" class="text-xs text-slate-400 underline">Reset progress</button>
          </div>
          <div id="timeline" class="mt-4 space-y-8"></div>
        </section>

        <section class="mt-10 rounded-3xl border border-slate-800 bg-slate-900/60 p-5">
          <h2 class="text-lg font-semibold">üí∞ Budget Breakdown (Per Person)</h2>
          <ul class="mt-3 space-y-2 text-sm text-slate-200">
            <li>Gas: ~$20‚Äì$30</li>
            <li>Lodging: ~$100‚Äì$125 (shared room)</li>
            <li>Food: ~$80‚Äì$100 (family-style Indian dinners save money)</li>
            <li>Parking: ~$5 (split Whistler lot fee)</li>
            <li class="font-semibold">Total Target: $200‚Äì$250 CAD per person</li>
          </ul>
        </section>

        <section class="mt-10 rounded-3xl border border-slate-800 bg-slate-900/60 p-5">
          <h2 class="text-lg font-semibold">üö´ No Egg Cheat Sheet</h2>
          <div class="mt-4 grid gap-3 text-sm text-slate-200">
            <div class="rounded-2xl border border-slate-800 bg-slate-950/70 p-4">
              <p class="font-semibold">Tim Hortons</p>
              <p>Bagel w/ Peanut Butter OR Oatmeal (avoid muffins/croissants).</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-950/70 p-4">
              <p class="font-semibold">Sunny Chibas</p>
              <p>Vegan Tacos or Burritos (Beans, Guac, Salsa).</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-950/70 p-4">
              <p class="font-semibold">Indian Masala</p>
              <p>Chana Masala, Dal, Aloo Gobi + Tandoori Roti.</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-950/70 p-4">
              <p class="font-semibold">El Furniture Warehouse</p>
              <p>General Tao Bowl OR Veggie Burger (Lettuce Wrap, No Mayo).</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-950/70 p-4">
              <p class="font-semibold">Cloudburst Cafe</p>
              <p>Quinoa Veggie Burger (Fully Vegan/Safe).</p>
            </div>
          </div>
        </section>

        
      </main>
    </div>

    <script>
      const itinerary = [
        {
          id: "d1-launch",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "7:00 AM",
          title: "Surrey ‚Üí Sea-to-Sky Launch",
          type: "logistics",
          summary: "Depart from Surrey early to beat bridge traffic and catch sunrise views.",
          notes: [
            "Bridge Logic: leave at 7:00 AM to miss the rush.",
            "Coffee Stop: Tim Hortons.",
          ],
          coords: { lat: 49.1044, lng: -122.8011 },
        },
        {
          id: "d1-coffee",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "Morning",
          title: "Tim Hortons (Coffee Stop)",
          type: "food",
          summary: "Quick fuel before the scenery begins.",
          eggFree: [
            "Bagel with Peanut Butter (or Cream Cheese).",
            "Oatmeal.",
          ],
          coords: { lat: 49.1892, lng: -122.8457 },
        },
        {
          id: "d1-porteau",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "AM",
          title: "Porteau Cove",
          type: "activity",
          summary: "Walk the pier, spot seals, capture golden-hour photos.",
          notes: ["30-minute stop."],
          coords: { lat: 49.5513, lng: -123.2412 },
        },
        {
          id: "d1-shannon",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "AM",
          title: "Shannon Falls",
          type: "activity",
          summary: "Massive waterfall right off the highway. Low effort, high reward.",
          notes: ["20-minute stop."],
          coords: { lat: 49.7113, lng: -123.1576 },
        },
        {
          id: "d1-murrin",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "Late AM",
          title: "Murrin Park Loop ‚Üí Quercus Viewpoint",
          type: "activity",
          summary: "Shorter than the Chief with epic Howe Sound views.",
          notes: ["Wear boots (muddy) and bring layers."],
          coords: { lat: 49.6743, lng: -123.2074 },
        },
        {
          id: "d1-lunch",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "Lunch",
          title: "Sunny Chibas (Squamish)",
          type: "food",
          summary: "Legendary Mexican comfort food with vegan options.",
          eggFree: [
            "Vegan taco/burrito with bean filling, pico de gallo, guacamole.",
            "Ask to sub cheese for extra guacamole (often free).",
          ],
          coords: { lat: 49.6994, lng: -123.1552 },
        },
        {
          id: "d1-afternoon",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "Afternoon",
          title: "Choose Your Own Adventure",
          type: "activity",
          summary: "Pick based on energy levels.",
          notes: [
            "Option A: Alice Lake ‚Üí Stump Lake loop (quiet forest vibes).",
            "Option B: Tantalus Lookout (roadside glacier views).",
          ],
          coords: { lat: 49.7644, lng: -123.1532 },
        },
        {
          id: "d1-dinner",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "Dinner",
          title: "Indian Masala Bar & Grill (Squamish)",
          type: "food",
          summary: "Family-style Indian dinner to save cash.",
          eggFree: [
            "Chana Masala (chickpeas), Dal Makhani (lentils), Aloo Gobi (cauliflower).",
            "Breads: Tandoori Roti (safest/vegan). Ask if naan dough has egg just in case.",
          ],
          coords: { lat: 49.7014, lng: -123.1562 },
        },
        {
          id: "d1-lodging",
          day: "Day 1 ‚Ä¢ Tuesday",
          time: "Evening",
          title: "Base Camp Lodging",
          type: "logistics",
          summary: "Pick the vibe for the night.",
          notes: [
            "Option 1 (Party): Crash Hotel Party Room.",
            "Option 2 (Chill/Budget): Squamish Adventure Inn Family Room (kitchen for late-night chai).",
          ],
          coords: { lat: 49.7017, lng: -123.1556 },
        },
        {
          id: "d2-start",
          day: "Day 2 ‚Ä¢ Wednesday",
          time: "8:30 AM",
          title: "Squamish ‚Üí Whistler Morning Run",
          type: "logistics",
          summary: "Leave Squamish around 8:30 AM for Whistler.",
          notes: ["Parking: Day Lot 4 or 5 (cheapest ~ $10/day)."],
          coords: { lat: 50.1163, lng: -122.9574 },
        },
        {
          id: "d2-village",
          day: "Day 2 ‚Ä¢ Wednesday",
          time: "Morning",
          title: "Whistler Village Flex",
          type: "activity",
          summary: "Walk the Village Stroll, check Olympic Rings plaza.",
          notes: ["Side Quest: Train Wreck Hike (suspension bridge + graffiti cars)."],
          coords: { lat: 50.1163, lng: -122.9574 },
        },
        {
          id: "d2-lunch",
          day: "Day 2 ‚Ä¢ Wednesday",
          time: "Lunch",
          title: "El Furniture Warehouse (Whistler)",
          type: "food",
          summary: "Everything ~$10‚Äì$15. Best value in Whistler.",
          eggFree: [
            "General Tao Bowl (verify breading is egg-free).",
            "Veggie Burger: Lettuce Wrap, NO Mayo.",
          ],
          notes: [
            "Alternative: Tandoori Grill or Royal Taste of India (higher cost).",
          ],
          coords: { lat: 50.1142, lng: -122.9577 },
        },
        {
          id: "d2-brandywine",
          day: "Day 2 ‚Ä¢ Wednesday",
          time: "Afternoon",
          title: "Brandywine Falls (Secret Hack)",
          type: "logistics",
          summary: "Main parking gate often closed in winter.",
          notes: [
            "Do not park on the highway.",
            "Hack: Drive to Whistler Bungee Bridge and hike to the falls from the other side.",
          ],
          coords: { lat: 50.0469, lng: -123.0788 },
        },
        {
          id: "d2-traffic",
          day: "Day 2 ‚Ä¢ Wednesday",
          time: "Late Afternoon",
          title: "Traffic Kill Strategy",
          type: "logistics",
          summary: "Avoid the Ironworkers bridge traffic wall.",
          notes: [
            "Stop in Squamish: Coffee/treat at Cloudburst Cafe (vegan/egg-free cookies).",
            "Or walk the Squamish Dyke for sunset.",
            "Drive home around 6:30 PM for smooth sailing.",
          ],
          coords: { lat: 49.7016, lng: -123.1553 },
        },
      ];

      const timelineEl = document.getElementById("timeline");
      const findUsBtn = document.getElementById("findUsBtn");
      const locationOutput = document.getElementById("locationOutput");
      const resetProgressBtn = document.getElementById("resetProgress");
      const storageKey = "trip-progress";

      const groupByDay = itinerary.reduce((acc, item) => {
        acc[item.day] = acc[item.day] || [];
        acc[item.day].push(item);
        return acc;
      }, {});

      const loadProgress = () => {
        try {
          const saved = JSON.parse(localStorage.getItem(storageKey));
          return saved && typeof saved.currentIndex === "number" ? saved.currentIndex : 0;
        } catch (error) {
          return 0;
        }
      };

      const saveProgress = (index) => {
        localStorage.setItem(storageKey, JSON.stringify({ currentIndex: index }));
      };

      let currentIndex = loadProgress();

      const getNextStop = () => itinerary.find((item, index) => index >= currentIndex && item.coords);

      const formatDistance = (km) => {
        if (km < 1) return `${Math.round(km * 1000)} m`;
        if (km < 10) return `${km.toFixed(1)} km`;
        return `${Math.round(km)} km`;
      };

      const getDistanceKm = (lat1, lon1, lat2, lon2) => {
        const toRad = (value) => (value * Math.PI) / 180;
        const radius = 6371;
        const dLat = toRad(lat2 - lat1);
        const dLon = toRad(lon2 - lon1);
        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
          Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return radius * c;
      };

      const buildStopCard = (stop, index) => {
        const isComplete = index < currentIndex;
        const card = document.createElement("article");
        card.className = `rounded-3xl border ${isComplete ? "border-emerald-500/40 bg-emerald-500/10" : "border-slate-800 bg-slate-900/60"} p-5`;

        const badgeClass = {
          food: "bg-amber-500/15 text-amber-300",
          activity: "bg-sky-500/15 text-sky-300",
          logistics: "bg-rose-500/15 text-rose-300",
        };

        card.innerHTML = `
          <div class="flex items-start justify-between gap-4">
            <div>
              <p class="text-xs uppercase tracking-[0.2em] text-slate-400">${stop.time}</p>
              <h3 class="mt-1 text-lg font-semibold">${stop.title}</h3>
            </div>
            <span class="rounded-full px-3 py-1 text-xs font-semibold ${badgeClass[stop.type] || "bg-slate-700/40 text-slate-200"}">${stop.type}</span>
          </div>
          <p class="mt-3 text-sm text-slate-200">${stop.summary}</p>
        `;

        if (stop.notes) {
          const notes = document.createElement("ul");
          notes.className = "mt-3 space-y-2 text-sm text-slate-200";
          stop.notes.forEach((note) => {
            const li = document.createElement("li");
            li.className = "flex items-start gap-2";
            li.innerHTML = `<span class="text-slate-400">‚Ä¢</span><span>${note}</span>`;
            notes.appendChild(li);
          });
          card.appendChild(notes);
        }

        if (stop.eggFree) {
          const alert = document.createElement("div");
          alert.className = "mt-4 rounded-2xl border border-emerald-500/40 bg-emerald-500/10 p-4 text-sm text-emerald-100";
          alert.innerHTML = `
            <div class="flex items-center gap-2 font-semibold">
              <span>üåø</span>
              <span>Egg-Free Order</span>
            </div>
          `;
          const list = document.createElement("ul");
          list.className = "mt-2 space-y-1";
          stop.eggFree.forEach((item) => {
            const li = document.createElement("li");
            li.textContent = item;
            list.appendChild(li);
          });
          alert.appendChild(list);
          card.appendChild(alert);
        }

        if (stop.coords) {
          const actions = document.createElement("div");
          actions.className = "mt-4 grid gap-2 sm:grid-cols-2";
          const destination = `${stop.coords.lat},${stop.coords.lng}`;
          actions.innerHTML = `
            <a class="rounded-2xl bg-slate-800 px-4 py-3 text-center text-sm font-semibold" href="https://www.google.com/maps/dir/?api=1&destination=${destination}" target="_blank" rel="noopener">Navigate</a>
            <a class="rounded-2xl border border-slate-700 bg-slate-950 px-4 py-3 text-center text-sm font-semibold" href="https://www.google.com/maps/search/?api=1&query=${destination}" target="_blank" rel="noopener">Reviews/Traffic</a>
          `;
          card.appendChild(actions);
        }

        const progressWrap = document.createElement("div");
        progressWrap.className = "mt-4 flex items-center justify-between text-xs text-slate-400";
        progressWrap.innerHTML = `<span>${isComplete ? "‚úÖ Completed" : "Next up"}</span>`;

        if (!isComplete) {
          const doneBtn = document.createElement("button");
          doneBtn.className = "rounded-full border border-slate-700 px-3 py-1 text-xs text-slate-200";
          doneBtn.textContent = "Mark done";
          doneBtn.addEventListener("click", () => {
            currentIndex = Math.min(currentIndex + 1, itinerary.length);
            saveProgress(currentIndex);
            renderTimeline();
          });
          progressWrap.appendChild(doneBtn);
        }

        card.appendChild(progressWrap);
        return card;
      };

      const renderTimeline = () => {
        timelineEl.innerHTML = "";
        Object.entries(groupByDay).forEach(([day, stops]) => {
          const section = document.createElement("section");
          section.className = "space-y-4";
          const heading = document.createElement("h3");
          heading.className = "text-lg font-semibold text-slate-100";
          heading.textContent = day;
          section.appendChild(heading);
          stops.forEach((stop) => {
            const index = itinerary.findIndex((item) => item.id === stop.id);
            section.appendChild(buildStopCard(stop, index));
          });
          timelineEl.appendChild(section);
        });
      };

      const updateLocationOutput = (content) => {
        locationOutput.innerHTML = content;
      };

      const handleFindUs = () => {
        if (!navigator.geolocation) {
          updateLocationOutput("<p>Your browser does not support geolocation.</p>");
          return;
        }

        updateLocationOutput("<p>Locating‚Ä¶</p>");
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            const nextStop = getNextStop();
            let distanceBlock = "";
            if (nextStop) {
              const distanceKm = getDistanceKm(latitude, longitude, nextStop.coords.lat, nextStop.coords.lng);
              distanceBlock = `
                <div class="mt-2 rounded-xl border border-slate-800 bg-slate-950/70 p-3">
                  <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Next Stop</p>
                  <p class="text-sm font-semibold">${nextStop.title}</p>
                  <p class="text-sm text-slate-300">~${formatDistance(distanceKm)} away</p>
                </div>
              `;
            }

            updateLocationOutput(`
              <p class="text-sm">Lat: ${latitude.toFixed(5)}, Lng: ${longitude.toFixed(5)}</p>
              ${distanceBlock}
            `);
          },
          () => {
            updateLocationOutput("<p>Unable to access location. Please allow location access.</p>");
          },
          { enableHighAccuracy: true, timeout: 10000 }
        );
      };

      findUsBtn.addEventListener("click", handleFindUs);

      resetProgressBtn.addEventListener("click", () => {
        currentIndex = 0;
        saveProgress(currentIndex);
        renderTimeline();
      });

      renderTimeline();
    </script>
  </body>
</html>
